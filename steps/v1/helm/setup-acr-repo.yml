parameters:
- name: repositoryName
  displayName: Helm Chart Repository Name
  type: string
- name: serviceConnectionName
  displayName: Azure Service Connection Name
  type: string

steps:
- task: AzureCLI@2
  displayName: Setup ${{ parameters.repositoryName }} Helm repo
  inputs:
    azureSubscription: '${{ parameters.serviceConnectionName }}'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      az configure --defaults acr=${{ parameters.repositoryName }}

      echo 'Adding repo'
      az acr helm repo add --name ${{ parameters.repositoryName }}
- template: ./update-repo.yml
- template: ./list-available-charts.yml
  parameters:
    repositoryName: '${{ parameters.repositoryName }}'